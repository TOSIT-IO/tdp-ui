{
  "openapi": "3.0.2",
  "info": { "title": "tdp-server", "version": "0.1.0" },
  "paths": {
    "/api/v1/service/": {
      "get": {
        "tags": ["services"],
        "summary": "Get Services",
        "description": "Returns the list of services",
        "operationId": "get_services_api_v1_service__get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Get Services Api V1 Service  Get",
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Service" }
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/service/{service_id}": {
      "get": {
        "tags": ["services"],
        "summary": "Get Service",
        "description": "Gets service identified by its id",
        "operationId": "get_service_api_v1_service__service_id__get",
        "parameters": [
          {
            "required": true,
            "schema": { "title": "Service Id", "type": "string" },
            "name": "service_id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Service" }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "400": {
            "description": "Service id does not exists",
            "content": {
              "application/json": {
                "example": { "detail": "{service_id} does not exists" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      },
      "put": {
        "tags": ["services"],
        "summary": "Put Service",
        "description": "Sets a service definition.",
        "operationId": "put_service_api_v1_service__service_id__put",
        "parameters": [
          {
            "required": true,
            "schema": { "title": "Service Id", "type": "string" },
            "name": "service_id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ServiceUpdate" }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ServiceUpdateResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "400": {
            "description": "Service id does not exists",
            "content": {
              "application/json": {
                "example": { "detail": "{service_id} does not exists" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:write"] }]
      },
      "patch": {
        "tags": ["services"],
        "summary": "Patch Service",
        "description": "Modifies a service definition.",
        "operationId": "patch_service_api_v1_service__service_id__patch",
        "parameters": [
          {
            "required": true,
            "schema": { "title": "Service Id", "type": "string" },
            "name": "service_id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ServiceUpdate" }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ServiceUpdateResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "400": {
            "description": "Service id does not exists",
            "content": {
              "application/json": {
                "example": { "detail": "{service_id} does not exists" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:write"] }]
      }
    },
    "/api/v1/service/{service_id}/component/{component_id}": {
      "get": {
        "tags": ["components"],
        "summary": "Get Component",
        "description": "Gets component identified by its id",
        "operationId": "get_component_api_v1_service__service_id__component__component_id__get",
        "parameters": [
          {
            "required": true,
            "schema": { "title": "Component Id", "type": "string" },
            "name": "component_id",
            "in": "path"
          },
          {
            "required": true,
            "schema": { "title": "Service Id", "type": "string" },
            "name": "service_id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Component" }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "400": {
            "description": "Component id does not exists",
            "content": {
              "application/json": {
                "example": { "detail": "{component_id} does not exists" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      },
      "put": {
        "tags": ["components"],
        "summary": "Put Component",
        "description": "Sets a component definition.",
        "operationId": "put_component_api_v1_service__service_id__component__component_id__put",
        "parameters": [
          {
            "required": true,
            "schema": { "title": "Component Id", "type": "string" },
            "name": "component_id",
            "in": "path"
          },
          {
            "required": true,
            "schema": { "title": "Service Id", "type": "string" },
            "name": "service_id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ComponentUpdate" }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ComponentUpdateResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "400": {
            "description": "Component id does not exists",
            "content": {
              "application/json": {
                "example": { "detail": "{component_id} does not exists" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:write"] }]
      },
      "patch": {
        "tags": ["components"],
        "summary": "Patch Component",
        "description": "Modifies a component definition.",
        "operationId": "patch_component_api_v1_service__service_id__component__component_id__patch",
        "parameters": [
          {
            "required": true,
            "schema": { "title": "Component Id", "type": "string" },
            "name": "component_id",
            "in": "path"
          },
          {
            "required": true,
            "schema": { "title": "Service Id", "type": "string" },
            "name": "service_id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ComponentUpdate" }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ComponentUpdateResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "400": {
            "description": "Component id does not exists",
            "content": {
              "application/json": {
                "example": { "detail": "{component_id} does not exists" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:write"] }]
      }
    },
    "/api/v1/deploy/dag": {
      "post": {
        "tags": ["deploy"],
        "summary": "Dag",
        "description": "Launches a deployment from the dag",
        "operationId": "dag_api_v1_deploy_dag_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "title": "Deploy Request",
                "allOf": [{ "$ref": "#/components/schemas/DeployRequest" }],
                "default": { "restart": false }
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "409": {
            "description": "Another deployment is still running, only one deployment at a time is allowed",
            "content": {
              "application/json": {
                "example": { "detail": "another deployment is still running" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:execute"] }]
      }
    },
    "/api/v1/deploy/operations": {
      "post": {
        "tags": ["deploy"],
        "summary": "Operations",
        "description": "Run a list of operations on the cluster, can use operations outside\nof the dag",
        "operationId": "operations_api_v1_deploy_operations_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/OperationsRequest" }
            }
          },
          "required": true
        },
        "responses": {
          "202": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "409": {
            "description": "Another deployment is still running, only one deployment at a time is allowed",
            "content": {
              "application/json": {
                "example": { "detail": "another deployment is still running" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:execute"] }]
      }
    },
    "/api/v1/deploy/resume": {
      "post": {
        "tags": ["deploy"],
        "summary": "Resume",
        "operationId": "resume_api_v1_deploy_resume_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "title": "Resume Request",
                "allOf": [{ "$ref": "#/components/schemas/ResumeRequest" }],
                "default": {}
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "409": {
            "description": "Another deployment is still running, only one deployment at a time is allowed",
            "content": {
              "application/json": {
                "example": { "detail": "another deployment is still running" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:execute"] }]
      }
    },
    "/api/v1/deploy/reconfigure": {
      "post": {
        "tags": ["deploy"],
        "summary": "Reconfigure",
        "operationId": "reconfigure_api_v1_deploy_reconfigure_post",
        "responses": {
          "202": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "409": {
            "description": "Another deployment is still running, only one deployment at a time is allowed",
            "content": {
              "application/json": {
                "example": { "detail": "another deployment is still running" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:execute"] }]
      }
    },
    "/api/v1/deploy/status": {
      "get": {
        "tags": ["deploy"],
        "summary": "Deployment Status",
        "operationId": "deployment_status_api_v1_deploy_status_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/DeployStatus" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/deploy/": {
      "get": {
        "tags": ["deploy"],
        "summary": "Get Deployments",
        "operationId": "get_deployments_api_v1_deploy__get",
        "parameters": [
          {
            "required": false,
            "schema": { "title": "Limit", "type": "integer", "default": 15 },
            "name": "limit",
            "in": "query"
          },
          {
            "required": false,
            "schema": { "title": "Offset", "type": "integer", "default": 0 },
            "name": "offset",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Get Deployments Api V1 Deploy  Get",
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/DeploymentLog" }
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/deploy/{deployment_id}": {
      "get": {
        "tags": ["deploy"],
        "summary": "Get Deployment",
        "operationId": "get_deployment_api_v1_deploy__deployment_id__get",
        "parameters": [
          {
            "required": true,
            "schema": { "title": "Deployment Id", "type": "integer" },
            "name": "deployment_id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DeploymentLogWithOperations"
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/deploy/{deployment_id}/operation/{operation}": {
      "get": {
        "tags": ["deploy"],
        "summary": "Get Deployment Operation",
        "operationId": "get_deployment_operation_api_v1_deploy__deployment_id__operation__operation__get",
        "parameters": [
          {
            "required": true,
            "schema": { "title": "Deployment Id", "type": "integer" },
            "name": "deployment_id",
            "in": "path"
          },
          {
            "required": true,
            "schema": { "title": "Operation", "type": "string" },
            "name": "operation",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/OperationLog" }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/operation/": {
      "get": {
        "tags": ["operation"],
        "summary": "Get Operations",
        "description": "Returns every operations possible",
        "operationId": "get_operations_api_v1_operation__get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Get Operations Api V1 Operation  Get",
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Operation" }
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/operation/dag": {
      "get": {
        "tags": ["operation"],
        "summary": "Get Dag Operations",
        "description": "Return list of every dag operation, topologically sorted",
        "operationId": "get_dag_operations_api_v1_operation_dag_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Get Dag Operations Api V1 Operation Dag Get",
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Operation" }
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/operation/other": {
      "get": {
        "tags": ["operation"],
        "summary": "Get Other Operations",
        "description": "Returns operations outside of the dag",
        "operationId": "get_other_operations_api_v1_operation_other_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Get Other Operations Api V1 Operation Other Get",
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Operation" }
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/plan/dag": {
      "post": {
        "tags": ["plan"],
        "summary": "Dag",
        "description": "Returns operations generated by the dag",
        "operationId": "dag_api_v1_plan_dag_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "title": "Deploy Request",
                "allOf": [{ "$ref": "#/components/schemas/DeployRequest" }],
                "default": { "restart": false }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Dag Api V1 Plan Dag Post",
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Operation" }
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/plan/operations": {
      "post": {
        "tags": ["plan"],
        "summary": "Operations",
        "description": "Returns operations from input",
        "operationId": "operations_api_v1_plan_operations_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/OperationsRequest" }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Operations Api V1 Plan Operations Post",
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Operation" }
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/plan/resume": {
      "post": {
        "tags": ["plan"],
        "summary": "Resume",
        "description": "Returns operations to run if resume is needed",
        "operationId": "resume_api_v1_plan_resume_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "title": "Resume Request",
                "allOf": [{ "$ref": "#/components/schemas/ResumeRequest" }],
                "default": {}
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Resume Api V1 Plan Resume Post",
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Operation" }
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/plan/reconfigure": {
      "post": {
        "tags": ["plan"],
        "summary": "Reconfigure",
        "description": "Returns operations to run to reconfigure the cluster",
        "operationId": "reconfigure_api_v1_plan_reconfigure_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Reconfigure Api V1 Plan Reconfigure Post",
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Operation" }
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/schema/": {
      "get": {
        "tags": ["schema"],
        "summary": "Get Schemas",
        "operationId": "get_schemas_api_v1_schema__get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Get Schemas Api V1 Schema  Get",
                  "type": "object"
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "400": {
            "description": "Service id does not exists",
            "content": {
              "application/json": {
                "example": { "detail": "{service_id} does not exists" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/api/v1/schema/{service_id}": {
      "get": {
        "tags": ["schema"],
        "summary": "Get Schema",
        "operationId": "get_schema_api_v1_schema__service_id__get",
        "parameters": [
          {
            "required": true,
            "schema": { "title": "Service Id", "type": "string" },
            "name": "service_id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Get Schema Api V1 Schema  Service Id  Get",
                  "type": "object"
                }
              }
            }
          },
          "401": {
            "description": "Unauthenticated",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Error during authentication validation (reason)"
                }
              }
            }
          },
          "403": {
            "description": "Not enough privileges",
            "headers": {
              "WWW-Authenticate": {
                "description": "Authentication method to use",
                "schema": { "type": "string" }
              }
            },
            "content": {
              "application/json": {
                "example": { "detail": "Not enough permissions" }
              }
            }
          },
          "400": {
            "description": "Service id does not exists",
            "content": {
              "application/json": {
                "example": { "detail": "{service_id} does not exists" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        },
        "security": [{ "OpenIdConnect": ["tdp_server:read"] }]
      }
    },
    "/": {
      "get": {
        "summary": "Root",
        "operationId": "root__get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Component": {
        "title": "Component",
        "required": ["id", "service_id", "version"],
        "type": "object",
        "properties": {
          "id": { "title": "Id", "type": "string" },
          "service_id": { "title": "Service Id", "type": "string" },
          "variables": { "$ref": "#/components/schemas/Variables" },
          "version": { "title": "Version", "type": "string" }
        },
        "example": {
          "id": "journalnode",
          "version": "ff4627859010bbd6f43808b51121972c0345bbc0",
          "variables": {
            "hdfs_site": {
              "dfs.journalnode.kerberos.principal": "jn/master-01.lan@TDP.REALM"
            }
          }
        }
      },
      "ComponentUpdate": {
        "title": "ComponentUpdate",
        "required": ["message", "variables"],
        "type": "object",
        "properties": {
          "message": { "title": "Message", "type": "string" },
          "variables": { "$ref": "#/components/schemas/Variables" }
        }
      },
      "ComponentUpdateResponse": {
        "title": "ComponentUpdateResponse",
        "required": ["message", "version"],
        "type": "object",
        "properties": {
          "message": { "title": "Message", "type": "string" },
          "version": { "title": "Version", "type": "string" }
        }
      },
      "DeployRequest": {
        "title": "DeployRequest",
        "type": "object",
        "properties": {
          "targets": {
            "title": "Deployment Targets",
            "type": "array",
            "items": { "type": "string" },
            "description": "List of operations used as targets on the dag generation, mutually exclusive with `sources`."
          },
          "sources": {
            "title": "Deployment Sources",
            "type": "array",
            "items": { "type": "string" },
            "description": "List of operations used as sources on the dag generation, mutually exclusive with `targets`."
          },
          "filter_type": {
            "title": "Deployment Sources",
            "allOf": [{ "$ref": "#/components/schemas/FilterTypeEnum" }],
            "description": "Controls how the filter expression must be interpreted."
          },
          "filter_expression": {
            "title": "Filter Expression",
            "type": "string",
            "description": "Expression which will match on the operation list generated from the dag. Only operations matching will be kept for the deployment."
          },
          "restart": {
            "title": "Replace starts",
            "type": "boolean",
            "description": "Controls whether or not start operations will be replaced by a restart operation.",
            "default": false
          }
        }
      },
      "DeployStatus": {
        "title": "DeployStatus",
        "required": ["message"],
        "type": "object",
        "properties": { "message": { "title": "Message", "type": "string" } }
      },
      "DeploymentLog": {
        "title": "DeploymentLog",
        "required": ["id", "start_time", "state", "operations"],
        "type": "object",
        "properties": {
          "id": { "title": "Id", "type": "integer" },
          "sources": {
            "title": "Sources",
            "type": "array",
            "items": { "type": "string" }
          },
          "targets": {
            "title": "Targets",
            "type": "array",
            "items": { "type": "string" }
          },
          "filter_expression": {
            "title": "Filter Expression",
            "type": "string"
          },
          "start_time": {
            "title": "Start Time",
            "type": "string",
            "format": "date-time"
          },
          "end_time": {
            "title": "End Time",
            "type": "string",
            "format": "date-time"
          },
          "restart": {
            "title": "Restart",
            "type": "boolean",
            "default": false
          },
          "state": { "$ref": "#/components/schemas/StateEnum" },
          "operations": {
            "title": "Operations",
            "type": "array",
            "items": { "type": "string" }
          },
          "user": {
            "title": "User",
            "type": "string",
            "default": "NO_USER_RECORDED"
          }
        }
      },
      "DeploymentLogWithOperations": {
        "title": "DeploymentLogWithOperations",
        "required": ["id", "start_time", "state", "operations"],
        "type": "object",
        "properties": {
          "id": { "title": "Id", "type": "integer" },
          "sources": {
            "title": "Sources",
            "type": "array",
            "items": { "type": "string" }
          },
          "targets": {
            "title": "Targets",
            "type": "array",
            "items": { "type": "string" }
          },
          "filter_expression": {
            "title": "Filter Expression",
            "type": "string"
          },
          "start_time": {
            "title": "Start Time",
            "type": "string",
            "format": "date-time"
          },
          "end_time": {
            "title": "End Time",
            "type": "string",
            "format": "date-time"
          },
          "restart": {
            "title": "Restart",
            "type": "boolean",
            "default": false
          },
          "state": { "$ref": "#/components/schemas/StateEnum" },
          "operations": {
            "title": "Operations",
            "type": "array",
            "items": { "$ref": "#/components/schemas/OperationLog" }
          },
          "user": {
            "title": "User",
            "type": "string",
            "default": "NO_USER_RECORDED"
          }
        }
      },
      "FilterTypeEnum": {
        "title": "FilterTypeEnum",
        "enum": ["regex", "glob"],
        "type": "string",
        "description": "An enumeration."
      },
      "HTTPValidationError": {
        "title": "HTTPValidationError",
        "type": "object",
        "properties": {
          "detail": {
            "title": "Detail",
            "type": "array",
            "items": { "$ref": "#/components/schemas/ValidationError" }
          }
        }
      },
      "Operation": {
        "title": "Operation",
        "required": ["name", "service", "action"],
        "type": "object",
        "properties": {
          "name": { "title": "Name", "type": "string" },
          "collection_name": { "title": "Collection Name", "type": "string" },
          "depends_on": {
            "title": "Depends On",
            "type": "array",
            "items": { "type": "string" },
            "default": []
          },
          "noop": { "title": "Noop", "type": "boolean", "default": false },
          "service": { "title": "Service", "type": "string" },
          "action": { "title": "Action", "type": "string" },
          "component": { "title": "Component", "type": "string" }
        }
      },
      "OperationLog": {
        "title": "OperationLog",
        "required": ["operation", "start_time", "end_time", "state", "logs"],
        "type": "object",
        "properties": {
          "operation": { "title": "Operation", "type": "string" },
          "start_time": {
            "title": "Start Time",
            "type": "string",
            "format": "date-time"
          },
          "end_time": {
            "title": "End Time",
            "type": "string",
            "format": "date-time"
          },
          "state": { "$ref": "#/components/schemas/StateEnum" },
          "logs": { "title": "Logs", "type": "string", "format": "binary" }
        }
      },
      "OperationsRequest": {
        "title": "OperationsRequest",
        "required": ["operations"],
        "type": "object",
        "properties": {
          "operations": {
            "title": "Operations",
            "type": "array",
            "items": { "type": "string" },
            "description": "List of operations to be run on the cluster. Can be operations outside of the dag."
          }
        }
      },
      "ResumeRequest": {
        "title": "ResumeRequest",
        "type": "object",
        "properties": {
          "id": {
            "title": "Deployment ID",
            "type": "integer",
            "description": "Deployment ID to resume from. (must be a failed deployment)"
          }
        }
      },
      "Service": {
        "title": "Service",
        "required": ["id", "components", "version"],
        "type": "object",
        "properties": {
          "id": { "title": "Id", "type": "string" },
          "components": {
            "title": "Components",
            "type": "array",
            "items": { "$ref": "#/components/schemas/Component" }
          },
          "variables": { "$ref": "#/components/schemas/Variables" },
          "version": { "title": "Version", "type": "string" }
        },
        "example": {
          "id": "hdfs",
          "components": [
            {
              "id": "journalnode",
              "version": "ff4627859010bbd6f43808b51121972c0345bbc0",
              "variables": {
                "hdfs_site": {
                  "dfs.journalnode.kerberos.principal": "jn/master-01.lan@TDP.REALM"
                }
              }
            }
          ],
          "variables": {
            "hdfs_site": { "dfs.nameservices": "bigdata_cluster" }
          },
          "version": "ff4627859010bbd6f43808b51121972c0345bbc0"
        }
      },
      "ServiceUpdate": {
        "title": "ServiceUpdate",
        "required": ["message", "variables"],
        "type": "object",
        "properties": {
          "message": { "title": "Message", "type": "string" },
          "variables": { "$ref": "#/components/schemas/Variables" }
        }
      },
      "ServiceUpdateResponse": {
        "title": "ServiceUpdateResponse",
        "required": ["message", "version"],
        "type": "object",
        "properties": {
          "message": { "title": "Message", "type": "string" },
          "version": { "title": "Version", "type": "string" }
        }
      },
      "StateEnum": {
        "title": "StateEnum",
        "enum": ["Success", "Failure", "Pending"],
        "description": "An enumeration."
      },
      "ValidationError": {
        "title": "ValidationError",
        "required": ["loc", "msg", "type"],
        "type": "object",
        "properties": {
          "loc": {
            "title": "Location",
            "type": "array",
            "items": { "anyOf": [{ "type": "string" }, { "type": "integer" }] }
          },
          "msg": { "title": "Message", "type": "string" },
          "type": { "title": "Error Type", "type": "string" }
        }
      },
      "Variables": {
        "title": "Variables",
        "type": "object",
        "description": "A free form object used as a dictionnary in TDP sdk. You can use any kind of data understood as a JSON object",
        "example": {
          "hadoop_log_dir": "/var/log/hadoop",
          "yarn_site": { "yarn.http.policy": "HTTPS_ONLY" }
        }
      }
    },
    "securitySchemes": {
      "OpenIdConnect": {
        "type": "openIdConnect",
        "openIdConnectUrl": "http://keycloak:8080/auth/realms/tdp_server/.well-known/openid-configuration"
      }
    }
  }
}
